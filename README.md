# Проектная работа 7 спринта Интеграция Auth Service с Admin_panel и Movie_API
Ссылка на приватный репозиторий с командной работой: https://github.com/fersus85/Auth_sprint_2.git

## Описание сервиса
Сервис авторизации, предназначенный для управления аутентификацией пользователей и их правами доступа в приложениях. Он обеспечивает безопасный доступ к ресурсам и позволяет управлять ролями пользователей. Сервис можно интегрировать в любую микросервисную архитектуру веб-приложения.

## Основные функции
- Регистрация пользователя.
- Вход/выход пользователя в/из аккаунт(а).
- Аутентификация пользователей с использованием безопасных методов хеширования паролей.
- Функция изменения пароля.
- Получение пользователем своей истории входов в аккаунт.
- Управление ролями и правами доступа для различных уровней пользователей.
- Создание суперпользователей с неограниченными правами.
- Поддержка JWT (JSON Web Tokens) для безопасной передачи данных.

## Стек
- Язык программирования: Python 3.10
- Веб-фреймворк: FastAPI
  Используется для создания RESTful API.
- Сервер: Uvicorn
  Приложение запускается под управлением ASGI.
- База данных: PostgreSQL
  Используется для хранения информации о пользователях и ролях.
- ORM: SQLAlchemy
  Для работы с базой данных.
- Миграции: Alembic
  Для управления миграциями базы данных.
- Кеширование: Redis Cluster
  Используется для кеширования данных и хранения токенов.
- Аутентификация: FastAPI JWT
  Для работы с JSON Web Tokens.
- Инструменты:
  - Typer: Для создания командной строки.
  - Werkzeug: Для хеширования паролей.
- Веб-сервер: Nginx
  Используется как обратный прокси-сервер.
- Контейнеризация: Docker
  Для упрощения развертывания и управления зависимостями.

## Системные требования
- Python 3.10
- Docker
- Docker Compose
- утилита make (опционально)

## Настройки и запуск
1. Клонируйте репозиторий:
```bash
  git clone https://github.com/fersus85/Auth_sprint_1.git
```
2. Перейдите в директорию проекта:
```bash
  cd Auth_sprint_1
```
3. Разместите в корне проекта файл .env, копируйте в него переменные из .env.example
```bash
REDIS_HOST=redis
POSTGRES_USER=app
POSTGRES_PASSWORD=ваш пароль
POSTGRES_DB=auth
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
```
4. Запустите docker-compose:
```bash
  docker compose up -d
```
или используйте команду
```bash
  make up
```
5. Совершите миграцию данных:
```bash
  make db/migrate
```
6. Создание superuser
- Подключитесь к контейнеру с приложением:
```bash
docker exec -it auth-service-fastapi-auth-1 bash
```
- Выполните команду
```bash
pytho3 cli/superuser.py
```
- Следуйте инструкциям в терминале

## Документация API
Подробное описание всех доступных эндпоинтов можно найти в документации OpenAPI, запустив сервис:
[Документация API](http://localhost:80/api/openapi)

## Тестирование
Для запуска тестов, выполните команды:
```bash
  make test-up
  make test
  make test-down
```

## Makefile
все команды makefile можно увидеть, вызвав
```bash
  make help
```

## Контакты и поддержка
Для получения поддержки или вопросов обращайтесь по электронной почте:
- **Тимлид**: deriabin_85@mail.ru
- **Разработчик**: dmitcvetcov@yandex.ru
- **Разработчик**: maximsonis@gmail.com

# Changelog

## [Версия 1.0.0] - 2024-12-04
### Добавлено
- Инициализирована структура папок
- Настроены конфигурации Docker, Nginx

## [Версия 1.0.1] - 2024-12-07
### Добавлено
- Настроены подключения к хранилищам PostgreSQL и Redis
- Настроены миграции в бд PostgreSQL
- Добавлен makefile
- Описаны прототипы API

## [Версия 1.0.2] - 2024-12-09
### Добавлено
- Добавлены модели SQLAlchemy для сервиса
- Добавлен скрипт для миграций при старте сервиса
### Исправлено
- Изменена user schema

## [Версия 1.0.3] - 2024-12-11
### Добавлено
- Добавлен сервис аутентификации
- Добавлен сервис user
### Исправлено
- Дополнен скрипт миграций: записываются дефолтные роли

## [Версия 1.0.4] - 2024-12-13
### Добавлено
- Добавлен основной функционал сервиса ролей
- Добавлена консольная команда создания суперпользователя
- Добавлены тесты для сервиса auth
### Исправлено
- Исправлены ошибки в импортах

## [Версия 1.0.5] - 2024-12-14
### Добавлено
- Добавлена openapi документация
- Добавлен централизованный обработчик ошибок
- Добавлена команда для поднятия инфраструктуры для тестов
- Добавлен эндпоинт для проверки наличия прав у пользователя
- Добавлен Permission Cheker для защиты ручек admin
### Исправлено
- Исправлены ошибки в тестах
